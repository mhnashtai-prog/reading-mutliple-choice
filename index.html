<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Metro Reading Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="reading-metro.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg,#2c5aa0 0%,#f5a9ba 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
      margin: 0;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    
    .container { 
      max-width: 720px; 
      margin: 0 auto; 
      padding: 24px 1vw 70px 1vw;
    }
    
    .header-section {
      text-align: center;
      margin-bottom: 32px;
    }
    
    h1 {
      color: #fff; 
      font-size: 1.75rem; 
      font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
      font-weight: 500;
      letter-spacing: -0.02em;
      line-height: 1.1;
      margin: 0 0 12px 0;
      text-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      color: rgba(255,255,255,0.95); 
      font-size: 1.4rem; 
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      font-weight: 500;
      letter-spacing: 0.01em;
      margin: 0 0 6px 0;
    }
    
    .test-count {
      color: rgba(255,255,255,0.85); 
      font-size: 1.1rem; 
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin: 0 0 8px 0;
    }
    
    .intuity-credit {
      color: rgba(255,255,255,0.7); 
      font-size: 0.9rem; 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      font-weight: 400;
      font-style: normal; 
      letter-spacing: 0.02em;
      margin: 0 0 20px 0;
    }
    
    #metroLabels {
      margin: 0 auto;
      max-width: 640px;
      display: flex; 
      flex-direction: column; 
      gap: 3px;
    }
    
    .progress-summary {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 20px;
      text-align: center;
      color: rgba(255,255,255,0.9);
      font-size: 0.9rem;
      font-weight: 500;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .progress-bar {
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      height: 6px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #bfff00 0%, #8cffda 100%);
      height: 100%;
      border-radius: 20px;
      transition: width 0.5s ease;
    }

    /* Mobile Optimizations */
    @media (max-width: 700px) {
      h1 { font-size: 1.5rem; }
      .subtitle { font-size: 1.2rem; }
      .test-count { font-size: 1rem; }
      .intuity-credit { font-size: 0.85rem; }
    }
    
    @media (max-width: 440px) {
      .container { padding: 20px 4vw 60px 4vw; }
      h1 { font-size: 1.3rem; line-height: 1.2; }
      .subtitle { font-size: 1.1rem; }
      .test-count { font-size: 0.9rem; }
      .intuity-credit { font-size: 0.8rem; }
      #metroLabels { gap: 2px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-section">
      <h1>Reading Comprehension</h1>
      <div class="subtitle">Multiple Choice</div>
      <div class="test-count">12 Tests</div>
      <div class="intuity-credit">INTUITY by Majid Nashtai</div>
      
      <div class="progress-summary" id="progressSummary">
        <div>Progress: <span id="completedCount">0</span> of 12 tests completed</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
      </div>
    </div>
    
    <div id="metroLabels"></div>
  </div>

  <script>
    // Helper for progress tracking
    function getReadingProgress() {
      try { 
        return JSON.parse(localStorage.getItem("readingMetroProgress") || "{}"); 
      } catch { 
        return {}; 
      }
    }

    // Update progress summary
    function updateProgressSummary(totalCompleted, totalTests) {
      const progressPercent = Math.round((totalCompleted / totalTests) * 100);
      document.getElementById('completedCount').textContent = totalCompleted;
      document.getElementById('progressFill').style.width = `${progressPercent}%`;
      
      const summary = document.getElementById('progressSummary');
      if (totalCompleted === totalTests) {
        summary.style.background = 'linear-gradient(135deg, rgba(191,255,0,0.2) 0%, rgba(140,255,218,0.2) 100%)';
        summary.style.border = '1px solid rgba(191,255,0,0.3)';
      }
    }

    // Enhanced animation for staggered loading
    function animateElements() {
      const links = document.querySelectorAll('.metro-label-link');
      links.forEach((link, index) => {
        link.style.opacity = '0';
        link.style.transform = 'translateY(20px)';
        setTimeout(() => {
          link.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
          link.style.opacity = '1';
          link.style.transform = 'translateY(0)';
        }, index * 50);
      });
    }

    fetch("fetchfiles-reading-texts.json")
      .then(response => response.json())
      .then(passages => {
        const metroLabels = document.getElementById("metroLabels");
        const progress = getReadingProgress();
        let completedCount = 0;

        passages.forEach((p, i) => {
          const underConstruction = (p.title || "").toLowerCase().includes("under construction");
          const isCompleted = progress[p.id];
          if (isCompleted) completedCount++;

          // Create metro link element
          let linkContainer = document.createElement("div");
          linkContainer.innerHTML = `
            <span class="metro-label-link${isCompleted ? ' done' : ''}${underConstruction ? ' uc' : ''}" 
                  ${!underConstruction ? `onclick="window.location.href='reading-cards.html?test=${p.id}'"` : ''} 
                  tabindex="${underConstruction ? '-1' : '0'}">
              ${i + 1}. ${p.title}${underConstruction ? " (Coming Soon)" : ""}
              ${isCompleted ? '<span class="metro-progress-indicator">âœ“</span>' : ''}
            </span>
          `;
          
          metroLabels.appendChild(linkContainer.firstElementChild);
        });

        // Update progress summary
        updateProgressSummary(completedCount, passages.length);
        
        // Animate elements
        setTimeout(animateElements, 100);
      })
      .catch(error => {
        console.error('Error loading passages:', error);
        document.getElementById('metroLabels').innerHTML = 
          '<div style="color: rgba(255,255,255,0.8); text-align: center; padding: 20px;">Error loading tests. Please refresh the page.</div>';
      });

    // Add keyboard navigation
    document.addEventListener('keydown', function(e) {
      const focusedElement = document.activeElement;
      if (focusedElement && focusedElement.classList.contains('metro-label-link')) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          focusedElement.click();
        }
      }
    });

    // Add smooth scrolling for mobile navigation
    if ('scrollBehavior' in document.documentElement.style) {
      document.documentElement.style.scrollBehavior = 'smooth';
    }
  </script>
</body>
</html>
